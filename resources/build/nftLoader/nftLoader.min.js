!function(){"use strict";function e(e,t,a){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.config=a}e.prototype.init=function(r,s){this.cameraPara;var n,l=this.root,e=this.config;(n=e,new Promise(function(e,t){var a=new XMLHttpRequest;a.open("GET",n),a.responseType="json",a.onload=function(){e(a.response)},a.onerror=function(){t("error "+a.status)},a.send(null)})).then(function(t){!function(e){var t=document.createElement("div");t.id="loading";var a=document.createElement("img");a.src=e.loading.logo.src,a.alt=e.loading.logo.alt;var n=document.createElement("span");n.setAttribute("class","loading-text"),n.innerText=e.loading.loadingMessage,t.appendChild(a),t.appendChild(n);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(t),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var a=document.createElement("div");a.id="stats1",a.className="stats-item";var n=document.createElement("p");n.className="stats-item-title",n.innerText="Main",a.appendChild(n),t.appendChild(a);var i=document.createElement("div");i.id="stats2",i.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",i.appendChild(o),t.appendChild(i);var d=document.getElementById("loading");document.body.insertBefore(t,d)}}(s);var e=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var a=document.createElement("video");a.id="video",a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),e.appendChild(a),e.appendChild(t);var n=document.getElementById("loading");return document.body.insertBefore(e,n),{container:e,canvas:t,video:a}}(),a=(e.container,e.canvas),n=e.video;if(s){var i=new Stats;i.showPanel(0),document.getElementById("stats1").appendChild(i.dom);var o=new Stats;o.showPanel(0),document.getElementById("stats2").appendChild(o.dom)}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var d={audio:!1,video:!0};window.innerWidth<800&&(d={audio:!1,video:{width:{ideal:this.width},height:{ideal:this.height},facingMode:{exact:"environment"}}}),navigator.mediaDevices.getUserMedia(d).then(function(e){n.srcObject=e,n.addEventListener("loadedmetadata",function(){n.play(),function(e,t,a,n,i,o,d,r,s){var l,c,m,u,p,v,h,g,f,E,w,y,x,b=document.createElement("canvas"),T=b.getContext("2d"),C=new THREE.WebGLRenderer({canvas:i,alpha:s.renderer.alpha,antialias:s.renderer.antialias,precision:s.renderer.precision});C.setPixelRatio(window.devicePixelRatio);var R=new THREE.Scene,M=new THREE.Camera;M.matrixAutoUpdate=!1,R.add(M);var k=new THREE.AmbientLight(16777215);R.add(k),R.add(r);var H,A=function(e){H=e?JSON.parse(e.matrixGL_RH):null},P=Date.now();function B(){T.fillStyle="black",T.fillRect(0,0,f,E),T.drawImage(t,0,0,l,c,w,y,h,g);var e=T.getImageData(0,0,f,E);x.postMessage({type:"process",imagedata:e},[e.data.buffer])}var I=function(){L(),requestAnimationFrame(I)},L=function(){o();var e=Date.now();if(P=e,H){r.visible=!0;for(var t=0;t<16;t++)N.delta[t]=H[t]-N.interpolated[t],N.interpolated[t]=N.interpolated[t]+N.delta[t]/S;U(r.matrix,N.interpolated)}else r.visible=!1;C.render(R,M)};l=a,c=n,p=320/Math.max(l,c/3*4),v=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/a:1,m=l*v,u=c*v,h=l*p,g=c*p,f=Math.max(h,g/3*4),E=Math.max(g,h/4*3),w=(f-h)/2,y=(E-g)/2,b.style.clientWidth=f+"px",b.style.clientHeight=E+"px",b.width=f,b.height=E,C.setSize(m,u),(x=new Worker(s.workerUrl)).postMessage({type:"load",pw:f,ph:E,camera_para:s.cameraPara,marker:e,artoolkitUrl:s.artoolkitUrl}),x.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var a=JSON.parse(t.proj),n=f/h,i=E/g;a[0]*=n,a[4]*=n,a[8]*=n,a[12]*=n,a[1]*=i,a[5]*=i,a[9]*=i,a[13]*=i,U(M.projectionMatrix,a);break;case"endLoading":if(1==t.end){var o=document.getElementById("loading");o&&(o.querySelector(".loading-text").innerText="Start the tracking!",setTimeout(function(){o.parentElement.removeChild(o)},2e3))}break;case"found":A(t);break;case"not found":A(null)}d(),B()},I(),B()}(r,n,n.videoWidth,n.videoHeight,a,function(){s&&i.update()},function(){s&&o.update()},l,t)})}).catch(function(e){console.log(e.name+": "+e.message)})}})},e.prototype.add=function(e){this.root.add(e)},e.prototype.loadModel=function(e,t,a,n,i){var o,d=this.root;(new THREE.GLTFLoader).load(e,function(e){(o=e.scene).scale.set(i,i,i),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=a,o.position.z=n,d.matrixAutoUpdate=!1,d.add(o)})};new THREE.Clock;var S=24,N={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},U=function(e,t){var a=[];for(var n in t)a[n]=t[n];"function"==typeof e.elements.set?e.elements.set(a):e.elements=[].slice.call(a)};window.NFTLoader=e,window.THREE=THREE}();