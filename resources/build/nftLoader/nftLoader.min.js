!function(){"use strict";var e=function(e,t,a){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.config=a};e.prototype.init=function(e,i){this.cameraPara;var o=this.root;(async function(e,t){return await new Promise(function(t,a){let n=new XMLHttpRequest;n.open("GET",e),n.responseType="json",n.onload=function(){t(n.response)},n.onerror=function(){a("error "+n.status)},n.send(null)})})(this.config).then(function(r){!function(e){var t=document.createElement("div");t.id="loading";var a=document.createElement("img");a.src=e.loading.logo.src,a.alt=e.loading.logo.alt;var n=document.createElement("span");n.setAttribute("class","loading-text"),n.innerText=e.loading.loadingMessage,t.appendChild(a),t.appendChild(n);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(r),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var a=document.createElement("div");a.id="stats1",a.className="stats-item";var n=document.createElement("p");n.className="stats-item-title",n.innerText="Main",a.appendChild(n),t.appendChild(a);var i=document.createElement("div");i.id="stats2",i.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",i.appendChild(o),t.appendChild(i);var r=document.getElementById("loading");document.body.insertBefore(t,r)}}(i);var d=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var a=document.createElement("video");a.id="video",a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),e.appendChild(a),e.appendChild(t);var n=document.getElementById("loading");return document.body.insertBefore(e,n),{container:e,canvas:t,video:a}}(),s=(d.container,d.canvas),l=d.video;if(i){var c=new Stats;c.showPanel(0),document.getElementById("stats1").appendChild(c.dom);var m=new Stats;m.showPanel(0),document.getElementById("stats2").appendChild(m.dom)}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var u={audio:!1,video:!0};window.innerWidth<800&&(u={audio:!1,video:{width:{ideal:this.width},height:{ideal:this.height},facingMode:{exact:"environment"}}}),navigator.mediaDevices.getUserMedia(u).then(function(d){l.srcObject=d,l.addEventListener("loadedmetadata",function(){l.play(),function(e,i,o,r,d,s,l,c,m,u){var p,v,h,f,g,E,w,y,x,b,T,C,R,M=document.createElement("canvas"),k=M.getContext("2d"),H=new THREE.WebGLRenderer({canvas:s,alpha:u.renderer.alpha,antialias:u.renderer.antialias,precision:u.renderer.precision});H.setPixelRatio(window.devicePixelRatio);var A=new THREE.Scene,P=new THREE.Camera;P.matrixAutoUpdate=!1,A.add(P);var B=new THREE.AmbientLight(16777215);A.add(B),A.add(m);var I,L=function(e){I=e?JSON.parse(e.matrixGL_RH):null},S=Date.now();function N(){k.fillStyle="black",k.fillRect(0,0,x,b),k.drawImage(o,0,0,p,v,T,C,w,y);var e=k.getImageData(0,0,x,b);R.postMessage({type:"process",imagedata:e},[e.data.buffer])}var U=function(){D(),requestAnimationFrame(U)},D=function(){l();var e=Date.now(),i=e-S;if(i,S=e,I){m.visible=!0;for(var o=0;o<16;o++)a.delta[o]=I[o]-a.interpolated[o],a.interpolated[o]=a.interpolated[o]+a.delta[o]/t;n(m.matrix,a.interpolated)}else m.visible=!1;H.render(A,P)};p=r,v=d,g=320/Math.max(p,v/3*4),E=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/r:1,h=p*E,f=v*E,w=p*g,y=v*g,x=Math.max(w,y/3*4),b=Math.max(y,w/4*3),T=(x-w)/2,C=(b-y)/2,M.style.clientWidth=x+"px",M.style.clientHeight=b+"px",M.width=x,M.height=b,H.setSize(h,f),(R=new Worker(u.workerUrl)).postMessage({type:"load",pw:x,ph:b,camera_para:u.cameraPara,marker:i,artoolkitUrl:u.artoolkitUrl}),R.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var a=JSON.parse(t.proj),i=x/w,o=b/y;a[0]*=i,a[4]*=i,a[8]*=i,a[12]*=i,a[1]*=o,a[5]*=o,a[9]*=o,a[13]*=o,n(P.projectionMatrix,a);break;case"endLoading":if(1==t.end){var r=document.getElementById("loading");r&&(r.querySelector(".loading-text").innerText="Start the tracking!",setTimeout(function(){r.parentElement.removeChild(r)},2e3))}break;case"found":L(t);break;case"not found":L(null)}c(),N()},U(),N()}(0,e,l,l.videoWidth,l.videoHeight,s,function(){i&&c.update()},function(){i&&m.update()},o,r)})}).catch(function(e){console.log(e.name+": "+e.message)})}})},e.prototype.add=function(e){this.root.add(e)},e.prototype.loadModel=function(e,t,a,n,i){var o,r=this.root;(new THREE.GLTFLoader).load(e,function(e){(o=e.scene).scale.set(i,i,i),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=a,o.position.z=n,r.matrixAutoUpdate=!1,r.add(o)})};new THREE.Clock;var t=24,a={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},n=function(e,t){var a=[];for(var n in t)a[n]=t[n];"function"==typeof e.elements.set?e.elements.set(a):e.elements=[].slice.call(a)};window.NFTLoader=e,window.THREE=THREE}();